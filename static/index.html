<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style>
    * {
      --progress-bar-color: black;
      --progress-bar-progress-color: #4169e1;
      --fading-height: 100px;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .main {
      width: 100%;
      height: calc(2 * 100vh - var(--fading-height));
    }

    .main-content {
      width: 100%;
      height: 90%;

      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      flex-grow: 0;
    }

    .main-background {
      background-image: url("./assets/pool.jpg");
      background-position: top center;
      background-attachment: scroll;
      background-size: cover;
      height: calc(100vh + var(--fading-height));
      width: 100%;

      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      flex-grow: 0;
    }
    .placeholder {
      height: 100vh;
      width: 100%;
    }

    /*Main content with progress bar and title*/
    .main-container {
      background: rgba( 255, 255, 255, 0.35 );
      box-shadow: 0 8px 32px 0 rgba( 31, 38, 135, 0.37 );
      backdrop-filter: blur( 12px );
      -webkit-backdrop-filter: blur( 12px );
      border-radius: 10px;
      border: 1px solid rgba( 255, 255, 255, 0.18 );

      width: 80%;
      height: 60%;
      padding: 5px;

      display: flex;
      justify-content: center;
      flex-wrap: wrap;

      z-index: 10;
    }

    /*Navigation*/
    .nav-container {
      background: rgba( 255, 255, 255, 0.35 );
      box-shadow: 0 8px 32px 0 rgba( 31, 38, 135, 0.37 );
      backdrop-filter: blur( 12px );
      -webkit-backdrop-filter: blur( 12px );
      border-radius: 10px;
      border: 1px solid rgba( 255, 255, 255, 0.18 );

      width: 75%;
      height: 7%;
      margin-bottom: 1%;
      margin-top: 4%;

      z-index: 10;

      box-sizing: border-box;
    }
    .nav-link {
      display: block;
      top: -1px;

      height: calc(100% + 1px);
      border: none;
      box-shadow: none;

      content: "";

      background-image: url("./assets/logo.png");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center top;

      transition: all 0.2s;
      border-radius: 10px;
    }
    .nav-link:hover {
      box-shadow: 1px 4px 5px 1px rgba(0,0,0,0.75);
      -webkit-box-shadow: 1px 4px 5px 1px rgba(0,0,0,0.75);
      -moz-box-shadow: 1px 4px 5px 1px rgba(0,0,0,0.75);
    }

    .logo {
      height: 100%;
    }

    /*Progress Bars*/
    .progress-bar-container {
      width: 100%;
      position: relative;

      display: flex;
      flex-direction: column;
    }
    .progress-bar {
      width: 100%;
      height: 3vh;
      border-radius: 25px;
      /*border: 1px solid var(--progress-bar-color);*/
      padding: 0;
      margin: 0;

      top: 2em;

      display: flex;
      flex-direction: row;
      flex-grow: 0;
      flex-shrink: 1;

      position: relative;
    }
    .progress-bar-content-circle {
      width: 3vh;
      height: 3vh;

      top: -1px;

      border-radius: 25px;
      border: 1px solid var(--progress-bar-color);

      position: relative;
      display: block;

      content: "";
    }
    .progress-bar-content-line {
      width: calc(100% - 2*3vh + 4px);
      height: 0.2vh;

      margin-top: auto;
      margin-bottom: auto;
      position: relative;

      background-color: var(--progress-bar-color);

      content: "";
    }
    .progress-bar-content-progress {
      position: absolute;
      height: 1.5vh;
      width: 1.5vh;
      content: "";
      margin: 0.75vh;

      top: -1px;
      left: -1px;
      z-index: 20;

      background-color: var(--progress-bar-progress-color);

      border: 1px solid var(--progress-bar-progress-color);
      border-radius: 25px;

      transition: all 0.5s;
    }
    .progress-bar-content-p-line {
      position: absolute;
    }

    .progress-bar-text {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
    }
    .init {
      opacity: 0;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        top: 10px;
      }
      to {
        opacity: 1;
        top: 0;
      }
    }

    /*Description Paragraph*/
    .description {
      /*background-color: #005f89;*/
      padding: 10px;
      position: relative;
      top: calc(-1 * var(--fading-height));

      height: calc(100vh - (10px * 2)); /* 10px cause padding above */
      margin-bottom: calc(-1 * var(--fading-height));

      display: flex;
      justify-content: center;
      align-items: center;

      /*background: rgb(2,0,36);
      background: linear-gradient(333deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%);*/
      background-image: -webkit-gradient(linear,left top,left bottom,color-stop(5%,#2f6ed3),color-stop(20%,#5095e4),color-stop(60%,#5095e4),color-stop(95%,#2f6ed3));
      background-image: -moz-linear-gradient(top,#2f6ed3 5%,#5095e4 20%,#5095e4 60%,#2f6ed3 95%);
      background-image: linear-gradient(180deg,#2f6ed3 5%,#5095e4 20%,#5095e4 60%,#2f6ed3 95%);

      -webkit-mask-image: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(0,0,0,1) 10%, rgba(0,0,0,1) 100%);
      mask-image: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(0,0,0,1) 10%, rgba(0,0,0,1) 100%);
    }
    .description-container {
      background: rgba( 0, 212, 255, 0.25 );
      box-shadow: 0 8px 32px 0 rgba( 31, 38, 135, 0.37 );
      backdrop-filter: blur( 1px );
      -webkit-backdrop-filter: blur( 1px );
      border-radius: 10px;
      border: 1px solid rgba( 255, 255, 255, 0.18 );

      color: white;
      font-size: 115%;

      width: 80%;
      height: 60%;

      padding: 20px;
      box-sizing: border-box;

      position: relative;

      display: flex;
      /*justify-content: center;*/
      align-items: center;
      flex-wrap: wrap;
      flex-direction: column;
    }

    /*link*/
    .anchor {
      text-decoration: none;
      color: black;
      font-size: 150%;
      border: 1px solid rgba( 255, 255, 255, 0.8 );
      padding: 10px;
      border-radius: 10px;
      transition: box-shadow 0.2s;
    }
    .anchor:hover {
      box-shadow: 2px 8px 5px 0px rgba(0,0,0,0.75);
      -webkit-box-shadow: 2px 8px 5px 0px rgba(0,0,0,0.75);
      -moz-box-shadow: 2px 8px 5px 0px rgba(0,0,0,0.75);
    }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Charity Channel Swim</title>
  </head>
  <body>

    <div class="main">
      <div id="background" class="main-background">
        <div class="main-content">
          <div class="nav-container">
            <a href="https://kings-rochester.co.uk" class="nav-link"></a>
          </div>
          <div class="main-container">
            <h1 class="title">Charity Channel Swim</h1>

            <div class="progress-bar-container">
              <div class="progress-bar-text">
                <span style="font-size: 90%" class="init">Current: <span id="curr"></span></span>
                <span style="float: right; font-size: 90%" class="init">Goal: <span id="goal"></span></span>
                <span style="position: absolute; top: 0; left: 50%; transform: translate(-50%, 0); font-size: 120%" class="init" id="percentage"></span>
              </div>
              <div class="progress-bar">
                <div class="progress-bar-content-circle" style="left: -1px; margin-right: -1px"></div>
                <div class="progress-bar-content-line"></div>
                <div class="progress-bar-content-circle circle-right" style="right: -1px; /*margin-left: auto*/; margin-left: -1px"></div>

                <div class="progress-bar-content-progress"></div>
              </div>
            </div>
            <div>
              <a href="https://www.justgiving.com/crowdfunding/kings-channel-swim" class="anchor">Donate!</a>
            </div>
          </div>
        </div>
      </div>
      <div class="description">
        <div class="description-container" id="dsc">
          As a school, we have set out with the aim of swimming the length of the English Channel. However, instead of physically swimming from one side to the other, we are teaming together in an attempt to swim 1300 lengths. This is equal in distance to swimming across the Channel. The goal of this event is to raise money for Cobbes Meadow Riding School for the Disabled, the school charity for the year. Cobbes Meadow Riding School for the Disabled is a wonderful charity that provides horse riding and carriage driving opportunities to children and adults with an array of disabilities. This can be a crucial way for people to build on their social skills and develop their motor skills in a new way, as well as providing the opportunity to try exciting new things and make new friends.
          <img src="./assets/poster.jpeg" height="100%" />
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
    const factor = 0.5;
    const xvalue = "center";
    window.addEventListener("load", () => {
      document.body.onscroll = () => {
        // parallax image bg
        const scrollTop = document.scrollingElement.scrollTop;
        const target = document.getElementById("background");
        const yvalue = scrollTop * factor;
        target.style.backgroundPosition = xvalue + " " + yvalue + "px";

        // description float-in
        const scrollBottom = window.innerHeight - document.scrollingElement.scrollTop;
        document.getElementById("dsc").style.top = scrollBottom + "px";
      }

      // get the curr data
      socket.emit("init");
    });
    </script>
    <script>
      const currData = {
        progress: 0
      }

      var socket = io();
      var init = true;
      socket.on("data", (data) => {
        for (key in data) {
          currData[key] = data[key];
        }
        updateProgress(data.progress);

        // update text
        document.querySelector("#curr").innerHTML = currData.curr;
        document.querySelector("#goal").innerHTML = currData.goal;
        document.querySelector("#percentage").innerHTML = Math.round(currData.progress) + "%"

        // animate on init
        if (!init) return;
        init = false;
        const txt = document.querySelectorAll(".progress-bar-text > *");
        for (let i = 0; i < txt.length; i++) {
          txt[i].style.animationName = "fadeIn";
          txt[i].style.animationDuration = "0.2s";
          txt[i].style.animationIterationCount = 1;
          txt[i].classList.remove("init")
        }
      });

      window.addEventListener("resize", () => {
        updateProgress(currData.progress);
      });

      Number.prototype.format = function() {
        return formatNumber(this);
      };

      function formatNumber(n) {
        if (("" + n).length <= 3) return n;
        let chars = (("" + n).includes(".")) ? ("" + n).substr(0, ("" + n).indexOf(".")).split("") : ("" + n).split("");
        let formatted = chars.reverse().reduce((prev, curr, i) => {
          if (typeof prev != "string") return curr;
          return (i % 3 == 0) ? prev + "," + curr : prev + curr;
        });
        return formatted.split("").reverse().join("") + (("" + n).includes(".") ? ("" + n).substr(("" + n).indexOf(".")) : "");
      }

      function vhToPx(vh) {
        return window.innerHeight * (vh / 100);
      }
      function updateProgress(percentage) {
        const bp = document.querySelector(".progress-bar");
        const width = bp.getBoundingClientRect().width - vhToPx(3); // calc(width - 3vh); 3vh == width of the circle
        const left = width * (percentage / 100) - 1;

        const circle = document.querySelector(".progress-bar-content-progress");
        circle.style.left = left + "px";

        /*const line = document.querySelector(".progress-bar-content-line");
        line.style.width = (left - vhToPx(3)) + "px";*/
      }
    </script>
  </body>
</html>
